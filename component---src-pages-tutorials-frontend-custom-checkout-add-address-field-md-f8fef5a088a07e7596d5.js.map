{"version":3,"file":"component---src-pages-tutorials-frontend-custom-checkout-add-address-field-md-f8fef5a088a07e7596d5.js","mappings":"oRAQaA,EAAe,CAAC,EACvBC,EAAc,CAClBD,gBAEIE,EAAYC,EAAAA,EACH,SAASC,EAAT,GAGZ,IAHgC,WACjCC,GAEC,EADEC,GACF,YACD,OAAO,SAACJ,GAAD,UAAeD,EAAiBK,EAAhC,CAAuCD,WAAYA,EAAYE,QAAQ,eAG5E,eACE,GAAM,uCACH,wCACL,kBAAK,uMACL,kBAAK,mGACL,oBACE,eAAIC,WAAW,OAAK,cAAGA,WAAW,KAC9B,KAAQ,mCACL,2BAA+B,MACtC,eAAIA,WAAW,OAAK,cAAGA,WAAW,KAC9B,KAAQ,oDACL,4CAAgD,MACvD,eAAIA,WAAW,OAAK,cAAGA,WAAW,KAC9B,KAAQ,2BACL,mBAAuB,MAC9B,eAAIA,WAAW,OAAK,cAAGA,WAAW,KAC9B,KAAQ,sCACL,kCAAsC,MAC7C,eAAIA,WAAW,OAAK,cAAGA,WAAW,KAC9B,KAAQ,+DACL,uDAA2D,OAEpE,eACE,GAAM,kCACH,oCACL,kBAAK,wDAAsD,cAAGA,WAAW,IACrE,KAAQ,yCACL,yBAA6B,wCAAsC,cAAGA,WAAW,IACpF,KAAQ,8CACL,UAAc,aAAW,uBAAYA,WAAW,KAAM,kEAA+E,kCAAgC,uBAAYA,WAAW,KAAM,UAAuB,0BAChO,kBAAK,gFAA8E,uBAAYA,WAAW,KAAM,oBAAiC,mCACjJ,qBAAK,iBAAMA,WAAW,MAClB,UAAa,+BACV,sqCA6BP,kBAAK,wDAAsD,uBAAYA,WAAW,KAAM,oBAAiC,iBAAe,uBAAYA,WAAW,KAAM,sDAAmE,2HAAyH,uBAAYA,WAAW,KAAM,iDAA8D,MAC5b,kBAAK,QAAM,uBAAYA,WAAW,KAAM,oBAAiC,0FAAwF,uBAAYA,WAAW,KAAM,wFAAqG,wGACnS,kBAAK,0DAAwD,cAAGA,WAAW,IACvE,KAAQ,2DACL,6BAAiC,2BAAyB,uBAAYA,WAAW,KAAM,mBAAgC,oEAAkE,uBAAYA,WAAW,KAAM,qCAAkD,6CAA2C,uBAAYA,WAAW,KAAM,kEAA+E,+DAA6D,uBAAYA,WAAW,KAAM,6EAA0F,4BAC1lB,kBAAK,gBAAc,uBAAYA,WAAW,KAAM,mBAAgC,8EAA4E,uBAAYA,WAAW,KAAM,iBAA8B,SAAO,uBAAYA,WAAW,KAAM,qCAAkD,kDAAgD,uBAAYA,WAAW,KAAM,yCAAsD,WAChb,qBAAK,iBAAMA,WAAW,MAClB,UAAa,gBACV,4SAQP,eACE,GAAM,mDACH,qDACL,kBAAK,qHACL,kBAAK,wIAAsI,uBAAYA,WAAW,KAAM,uCAAoD,4EAC5N,kBAAK,0EAAwE,uBAAYA,WAAW,KAAM,uDAAoE,iGAC9K,qBAAK,iBAAMA,WAAW,MAClB,UAAa,eACV,6gCA8BP,kBAAK,yFAAuF,uBAAYA,WAAW,KAAM,0CAAuD,QAAM,uBAAYA,WAAW,KAAM,sDAAmE,uGACtR,kBAAK,iFAA+E,cAAGA,WAAW,IAC9F,KAAQ,oIACL,wBAA4B,+CACnC,eACE,GAAM,0BACH,4BACL,kBAAK,6FAA2F,uBAAYA,WAAW,KAAM,uBAAoC,YAAU,uBAAYA,WAAW,KAAM,mCAAgD,gBACxP,kBAAK,yFACL,qBAAK,iBAAMA,WAAW,MAClB,UAAa,eACV,gQAUP,eACE,GAAM,qCACH,uCACL,kBAAK,sEAAoE,uBAAYA,WAAW,KAAM,4BAAyC,iBAAe,uBAAYA,WAAW,KAAM,yBAAsC,gBACjO,kBAAK,2CAAyC,uBAAYA,WAAW,KAAM,4BAAyC,WACpH,qBAAK,iBAAMA,WAAW,MAClB,UAAa,gBACV,qWAQP,kBAAK,cAAY,uBAAYA,WAAW,KAAM,kBAA+B,gCAA8B,uBAAYA,WAAW,KAAM,oBAAiC,6DAA2D,uBAAYA,WAAW,KAAM,8DAA2E,WAC5U,eACE,GAAM,8DACH,gEACL,kBAAK,wLACL,kBAAK,4EAA0E,uBAAYA,WAAW,KAAM,+CAA4D,gBACxK,qBAAK,iBAAMA,WAAW,MAClB,UAAa,gBACV,yhCAyCP,eACE,GAAM,2BACH,6BACL,oBACE,eAAIA,WAAW,OACb,cAAGA,WAAW,MAAO,2BACrB,gBAAKA,WAAW,OAAK,iBAAMA,WAAW,MAClC,UAAa,iBACV,qCAGT,eAAIA,WAAW,OACb,cAAGA,WAAW,MAAO,iCACrB,gBAAKA,WAAW,OAAK,iBAAMA,WAAW,MAClC,UAAa,iBACV,gDAGT,eAAIA,WAAW,OACb,cAAGA,WAAW,MAAO,0BACrB,gBAAKA,WAAW,OAAK,iBAAMA,WAAW,MAClC,UAAa,iBACV,gCAMd,CAEDJ,EAAWK,gBAAiB,C","sources":["webpack://commerce-php/./src/pages/tutorials/frontend/custom-checkout/add-address-field.md"],"sourcesContent":["import * as React from 'react'\n  /* @jsx mdx */\nimport { mdx } from '@mdx-js/react';\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\n\nimport DefaultLayout from \"/home/runner/work/commerce-php/commerce-php/node_modules/@adobe/gatsby-theme-aio/src/components/MDXFilter/index.js\";\nexport const _frontmatter = {};\nconst layoutProps = {\n  _frontmatter\n};\nconst MDXLayout = DefaultLayout;\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n\n    <h1 {...{\n      \"id\": \"add-a-new-field-in-the-address-form\"\n    }}>{`Add a new field in the address form`}</h1>\n    <p>{`You can add new fields to default checkout forms, such as shipping address or billing address forms. To illustrate this ability, this topic describes adding a field to the shipping address form.`}</p>\n    <p>{`To add your custom field to the checkout address form and access its value on the client side:`}</p>\n    <ol>\n      <li parentName=\"ol\"><a parentName=\"li\" {...{\n          \"href\": \"#step-1-add-the-field-to-layout\"\n        }}>{`Add the field to layout`}</a>{`.`}</li>\n      <li parentName=\"ol\"><a parentName=\"li\" {...{\n          \"href\": \"#step-2-add-a-js-mixin-to-modify-data-submission\"\n        }}>{`Add a JS mixin to modify data submission`}</a>{`.`}</li>\n      <li parentName=\"ol\"><a parentName=\"li\" {...{\n          \"href\": \"#step-3-load-your-mixin\"\n        }}>{`Load your mixin`}</a>{`.`}</li>\n      <li parentName=\"ol\"><a parentName=\"li\" {...{\n          \"href\": \"#step-4-add-field-to-address-model\"\n        }}>{`Add the field to address model`}</a>{`.`}</li>\n      <li parentName=\"ol\"><a parentName=\"li\" {...{\n          \"href\": \"#step-5-access-the-value-of-the-custom-field-on-server-side\"\n        }}>{`Access the value of the custom field on server side`}</a>{`.`}</li>\n    </ol>\n    <h2 {...{\n      \"id\": \"step-1-add-the-field-to-layout\"\n    }}>{`Step 1: Add the field to layout`}</h2>\n    <p>{`Both shipping address and billing address forms are `}<a parentName=\"p\" {...{\n        \"href\": \"add-form.md#dynamically-defined-forms\"\n      }}>{`generated dynamically`}</a>{`. To modify their layouts, create a `}<a parentName=\"p\" {...{\n        \"href\": \"../../../development/components/plugins.md\"\n      }}>{`plugin`}</a>{` for the `}<inlineCode parentName=\"p\">{`\\\\Magento\\\\Checkout\\\\Block\\\\Checkout\\\\LayoutProcessor::process`}</inlineCode>{` method and declare it in the `}<inlineCode parentName=\"p\">{`di.xml`}</inlineCode>{` file in your module.`}</p>\n    <p>{`The following code snippet enumerates sample logic for adding a field named `}<inlineCode parentName=\"p\">{`Custom Attribute`}</inlineCode>{` to the shipping address form:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-php?start_inline=1\"\n      }}>{`$customAttributeCode = 'custom_field';\n$customField = [\n    'component' => 'Magento_Ui/js/form/element/abstract',\n    'config' => [\n        // customScope is used to group elements within a single form (e.g. they can be validated separately)\n        'customScope' => 'shippingAddress.custom_attributes',\n        'customEntry' => null,\n        'template' => 'ui/form/field',\n        'elementTmpl' => 'ui/form/element/input',\n        'tooltip' => [\n            'description' => 'this is what the field is for',\n        ],\n    ],\n    'dataScope' => 'shippingAddress.custom_attributes' . '.' . $customAttributeCode,\n    'label' => 'Custom Attribute',\n    'provider' => 'checkoutProvider',\n    'sortOrder' => 0,\n    'validation' => [\n       'required-entry' => true\n    ],\n    'options' => [],\n    'filterBy' => null,\n    'customEntry' => null,\n    'visible' => true,\n    'value' => '' // value field is used to set a default value of the attribute\n];\n\n$jsLayout['components']['checkout']['children']['steps']['children']['shipping-step']['children']['shippingAddress']['children']['shipping-address-fieldset']['children'][$customAttributeCode] = $customField;\n`}</code></pre>\n    <p>{`Via the previous example, the field is added to the `}<inlineCode parentName=\"p\">{`customAttributes`}</inlineCode>{` property of `}<inlineCode parentName=\"p\">{`'Magento_Checkout/js/model/new-customer-address.js`}</inlineCode>{`, a JavaScript object that lists all predefined address attributes and matches the corresponding server-side interface `}<inlineCode parentName=\"p\">{`\\\\Magento\\\\Quote\\\\Api\\\\Data\\\\AddressInterface`}</inlineCode>{`.`}</p>\n    <p>{`The `}<inlineCode parentName=\"p\">{`customAttributes`}</inlineCode>{` property was designed to contain custom EAV address attributes and is related to the `}<inlineCode parentName=\"p\">{`\\\\Magento\\\\Quote\\\\Model\\\\Quote\\\\Address\\\\CustomAttributeListInterface::getAttributes`}</inlineCode>{` method. The sample code above will automatically handle local storage persistence on the frontend.`}</p>\n    <p>{`Optionally, instead of adding a plugin, you can use a `}<a parentName=\"p\" {...{\n        \"href\": \"../../../development/components/dependency-injection.md\"\n      }}>{`dependency injection (DI)`}</a>{`. To use a DI, add the `}<inlineCode parentName=\"p\">{`LayoutProcessor`}</inlineCode>{`, which adds the custom field to the address form class, to the `}<inlineCode parentName=\"p\">{`<your_module_dir>/Block/Checkout/`}</inlineCode>{` directory. The class must implement the `}<inlineCode parentName=\"p\">{`\\\\Magento\\\\Checkout\\\\Block\\\\Checkout\\\\LayoutProcessorInterface`}</inlineCode>{` interface. Use the code sample above as an example of the `}<inlineCode parentName=\"p\">{`\\\\Magento\\\\Checkout\\\\Block\\\\Checkout\\\\LayoutProcessorInterface::process()`}</inlineCode>{` method implementation.`}</p>\n    <p>{`To add your `}<inlineCode parentName=\"p\">{`LayoutProcessor`}</inlineCode>{` class the corresponding pool of processors, specify the following (where `}<inlineCode parentName=\"p\">{`%unique_name%`}</inlineCode>{` and `}<inlineCode parentName=\"p\">{`%path\\\\to\\\\your\\\\LayoutProcessor%`}</inlineCode>{` must be replaced by your real values) in the `}<inlineCode parentName=\"p\">{`<your_module_dir>/etc/frontend/di.xml`}</inlineCode>{` file:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-xml\"\n      }}>{`<type name=\"Magento\\\\Checkout\\\\Block\\\\Onepage\">\n        <arguments>\n            <argument name=\"layoutProcessors\" xsi:type=\"array\">\n                <item name=\"%unique_name%\" xsi:type=\"object\">%path\\\\to\\\\your\\\\LayoutProcessor%</item>\n            </argument>\n        </arguments>\n</type>\n`}</code></pre>\n    <h2 {...{\n      \"id\": \"step-2-add-a-js-mixin-to-modify-data-submission\"\n    }}>{`Step 2: Add a JS mixin to modify data submission`}</h2>\n    <p>{`Add a JS mixin, to the server side, to change the behavior of the component responsible for the data submission.`}</p>\n    <p>{`In your custom module, define a mixin as a separate AMD module that returns a callback function. Add the mixin file anywhere in the `}<inlineCode parentName=\"p\">{`<your_module_dir>/view/frontend/web`}</inlineCode>{` directory. There are no strict requirements for the mixin file naming.`}</p>\n    <p>{`The following code sample is a sample mixin modifying the behavior of `}<inlineCode parentName=\"p\">{`Magento_Checkout/js/action/set-shipping-information`}</inlineCode>{`, the component responsible for data submission between shipping and billing checkout steps:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-js\"\n      }}>{`/*jshint browser:true jquery:true*/\n/*global alert*/\ndefine([\n    'jquery',\n    'mage/utils/wrapper',\n    'Magento_Checkout/js/model/quote'\n], function ($, wrapper, quote) {\n    'use strict';\n\n    return function (setShippingInformationAction) {\n\n        return wrapper.wrap(setShippingInformationAction, function (originalAction) {\n            var shippingAddress = quote.shippingAddress();\n            if (shippingAddress['extension_attributes'] === undefined) {\n                shippingAddress['extension_attributes'] = {};\n            }\n\n            var attribute = shippingAddress.customAttributes.find(\n                function (element) {\n                    return element.attribute_code === 'custom_field';\n                }\n            );\n\n            shippingAddress['extension_attributes']['custom_field'] = attribute.value;\n            // pass execution to original action ('Magento_Checkout/js/action/set-shipping-information')\n            return originalAction();\n        });\n    };\n});\n`}</code></pre>\n    <p>{`When adding a field to the billing address form, you must modify the behavior of the `}<inlineCode parentName=\"p\">{`Magento_Checkout/js/action/place-order`}</inlineCode>{` or `}<inlineCode parentName=\"p\">{`Magento_Checkout/js/action/set-payment-information`}</inlineCode>{` component, depending on when do you need the custom field valued to be passed to the server side.`}</p>\n    <p>{`To see an example of a mixing that modifies one of these components, see the `}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/magento/magento2/blob/2.4/app/code/Magento/CheckoutAgreements/view/frontend/web/js/model/place-order-mixin.js\"\n      }}>{`place-order-mixin.js`}</a>{` in the Magento_CheckoutAgreements module.`}</p>\n    <h2 {...{\n      \"id\": \"step-3-load-your-mixin\"\n    }}>{`Step 3: Load your mixin`}</h2>\n    <p>{`Tell the application to load your mixin for the corresponding JS component by adding the `}<inlineCode parentName=\"p\">{`requirejs-config.js`}</inlineCode>{` to the `}<inlineCode parentName=\"p\">{`<YourModule_dir>/view/frontend/`}</inlineCode>{` directory.`}</p>\n    <p>{`The following code sample shows an example utilizing the sample mixin added earlier:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-js\"\n      }}>{`var config = {\n    config: {\n        mixins: {\n            'Magento_Checkout/js/action/set-shipping-information': {\n                '<YourNamespace_YourModule>/js/action/set-shipping-information-mixin': true\n            }\n        }\n    }\n};\n`}</code></pre>\n    <h2 {...{\n      \"id\": \"step-4-add-field-to-address-model\"\n    }}>{`Step 4: Add field to address model`}</h2>\n    <p>{`To add the field to the address model on the server side, add the `}<inlineCode parentName=\"p\">{`extension_attributes.xml`}</inlineCode>{` file in the `}<inlineCode parentName=\"p\">{`<YourModule_dir>/etc/`}</inlineCode>{` directory.`}</p>\n    <p>{`The following code is an example of an `}<inlineCode parentName=\"p\">{`extension_attributes.xml`}</inlineCode>{` file:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-xml\"\n      }}>{`<?xml version=\"1.0\"?>\n\n<config xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:noNamespaceSchemaLocation=\"urn:magento:framework:Api/etc/extension_attributes.xsd\">\n    <extension_attributes for=\"Magento\\\\Quote\\\\Api\\\\Data\\\\AddressInterface\">\n        <attribute code=\"custom_field\" type=\"string\" />\n    </extension_attributes>\n</config>\n`}</code></pre>\n    <p>{`Clear the `}<inlineCode parentName=\"p\">{`generated/code`}</inlineCode>{` directory when you run the `}<inlineCode parentName=\"p\">{`setup:di:compile`}</inlineCode>{` command. New getter and setter methods will be added in `}<inlineCode parentName=\"p\">{`generated/code/Magento/Quote/Api/Data/AddressExtension.php`}</inlineCode>{` file.`}</p>\n    <h2 {...{\n      \"id\": \"step-5-access-the-value-of-the-custom-field-on-server-side\"\n    }}>{`Step 5: Access the value of the custom field on server side`}</h2>\n    <p>{`If you completed all the steps described in the previous sections, the application generates the interface that includes your custom attribute and you can access your field value.`}</p>\n    <p>{`You can set/get these attributes values by creating an instance of the  `}<inlineCode parentName=\"p\">{`Magento/Quote/Api/Data/AddressInterface.php`}</inlineCode>{` interface.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-php\"\n      }}>{`<?php\n\n// ... //\n\nuse Magento\\\\Checkout\\\\Api\\\\Data\\\\ShippingInformationInterface;\nuse Magento\\\\Framework\\\\View\\\\Element\\\\Template;\nuse Magento\\\\Framework\\\\View\\\\Element\\\\Template\\\\Context;\n\nclass MyBlock extends Template {\n\n    /**\n     * @var ShippingInformationInterface\n     */\n    private $_addressInformation;\n\n    /**\n     * @param Context $context\n     * @param ShippingInformationInterface $addressInformation\n     * @param array $data\n     */\n    public function __construct(\n        Context $context,\n        ShippingInformationInterface $addressInformation,\n        array $data = []\n    ) {\n        $this->_addressInformation = $addressInformation;\n        parent::__construct($context, $data);\n    }\n\n    /**\n     * Get custom Shipping Charge\n     *\n     * @return String\n     */\n    public function getShippingCharge()\n    {\n        $extAttributes = $this->_addressInformation->getExtensionAttributes();\n        return $extAttributes->getCustomField(); //get custom attribute data.\n    }\n}\n`}</code></pre>\n    <h2 {...{\n      \"id\": \"step-6-run-cli-commands\"\n    }}>{`Step 6: Run CLI commands`}</h2>\n    <ol>\n      <li parentName=\"ol\">\n        <p parentName=\"li\">{`Compile the code with:`}</p>\n        <pre parentName=\"li\"><code parentName=\"pre\" {...{\n            \"className\": \"language-bash\"\n          }}>{`bin/magento setup:di:compile\n`}</code></pre>\n      </li>\n      <li parentName=\"ol\">\n        <p parentName=\"li\">{`Next, deploy static content:`}</p>\n        <pre parentName=\"li\"><code parentName=\"pre\" {...{\n            \"className\": \"language-bash\"\n          }}>{`bin/magento setup:static-content:deploy\n`}</code></pre>\n      </li>\n      <li parentName=\"ol\">\n        <p parentName=\"li\">{`Then clean the cache:`}</p>\n        <pre parentName=\"li\"><code parentName=\"pre\" {...{\n            \"className\": \"language-bash\"\n          }}>{`bin/magento cache:clean\n`}</code></pre>\n      </li>\n    </ol>\n\n    </MDXLayout>;\n}\n;\nMDXContent.isMDXComponent = true;\n      "],"names":["_frontmatter","layoutProps","MDXLayout","DefaultLayout","MDXContent","components","props","mdxType","parentName","isMDXComponent"],"sourceRoot":""}